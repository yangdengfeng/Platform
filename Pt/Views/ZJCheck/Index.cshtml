
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/Tab_Layout.cshtml";
}
@*<div class="container-fluid">
    <div class="row cl">
        <div id="form_container" style="width:100%;height:100%;"></div>
    </div>

    <div class="row mt-5" id="layoutObj" style="height:695px;">
        <div id="recinfoArea" style="width:100%;"></div>
        <div id="gridbox" style="width:100%;height:100%;"></div>
        <div id="pagingArea" style="width:100%;"></div>
    </div>
</div>*@



<div class="container-fluid">
    <div class="row cl ml-5">
        <div id="form_container" style="width:auto;height:100%"></div>
    </div>
    <div class="mt-10">
        <div id="gridbox" style="position:fixed;width:100%; top:160px; left: 0; right: 0; bottom: 10px; background-color:white;overflow:hidden"></div>
    </div>
</div>

@* xxf: 为导出Excel添加以下代码 ---------------------------------------------------- *@
<style>
    legend {
        margin-bottom: 0;
    }
</style>

<script type="text/javascript" src="~/Dhtmlx/ext/excel_exporter.js?v=1"></script>
@* ---------------------------------------------------------------------------- *@


<script type="text/javascript">
    var mygrid, myForm, dhxWins, applyWin, applyForm, auditWin, auditForm;
    var gridQString = '';


    function doOnLoad() {
        formStructure = [
              { type: "settings", position: "label-left", labelAlign: "right", inputWidth: 220, labelWidth: 120 },
               { type: "combo", label: "检测机构名称", name: "CheckUnitName" },
                { type: "combo", label: "区域", name: "Area", options: [{ text: "", value: "" }] },
                { type: "input", label: "检测设备", name: "CheckEquip" },
                { type: "combo", label: "报告", name: "Report", options: [{ text: "", value: "" }, { text: "有", value: "1" }, { text: "无", value: "0" }] },
                 { type: "newcolumn" },
                 { type: "calendar", label: "开始日期", name: "StartDate", dateFormat: "%Y-%m-%d" },
                  { type: "input", label: "工程名称", name: "ProjectName" },
                   { type: "input", label: "检测人员", name: "CheckPeople" },
                  {
                      type: "combo", label: "桩型", name: "ZX", options: [
                        { text: "", value: "" },
                        { text: "钻孔灌注桩", value: "钻孔灌注桩" },
                        { text: "冲孔灌注桩", value: "冲孔灌注桩" },
                        { text: "人工挖孔桩", value: "人工挖孔桩" },
                        { text: "预应力混凝土管桩", value: "预应力混凝土管桩" },
                        { text: "沉管灌注桩", value: "沉管灌注桩" },
                        { text: "水泥土搅拌桩", value: "水泥土搅拌桩" },
                        { text: "旋喷桩", value: "旋喷桩" },
                        { text: "水泥粉煤灰碎石桩", value: "水泥粉煤灰碎石桩" },
                        { text: "混凝土桩", value: "混凝土桩" },
                      ]
                  },
                   { type: "newcolumn" },
                   { type: "calendar", label: "结束日期", name: "EndDate", dateFormat: "%Y-%m-%d" },
                  {
                      type: "block", width: 340, list: [
                          { type: "button", name: 'Search', value: "查询", offsetLeft: 150 }
                      ]
                  }
        ];

        myForm = new dhtmlXForm("form_container", formStructure);


        myForm.attachEvent("onButtonClick", function (name) {
            if (name == "Search") {
                gridQString = '/ZJCheck/Search?' + getQueryStr();
                mygrid.clearAll();
                myTabbar.tabs("gridboxOne").progressOn();
                mygrid.load(gridQString, doOnGridLoaded);
            }

        });

        myTabbar = new dhtmlXTabBar({
            parent: "gridbox",
            tabs: [
                { id: "gridboxOne", text: "查询结果", active: true }
            ]
        });


        myTabbar.tabs("gridboxOne").attachStatusBar({
            text: "<div id='recinfoArea'></div><div id='pagingArea'></div>",
            paging: true
        });
        myTabbar.enableAutoReSize();

        mygrid = myTabbar.tabs("gridboxOne").attachGrid();

        mygrid.setImagePath("../../Dhtmlx/codebase/imgs/");
        mygrid.setHeader("序号,单位名称,工程名称,所在城市,设计总桩数,检测人员,见证人员,检测设备,检测流水号,报告信息,附件上传,操作");//设置列的头文本
        mygrid.setInitWidths("40,150,*,100,120,120,200,130,150,100,100,50");          //设置列的宽度，其中* 为动态宽度
        mygrid.setColAlign("right,left,left,left,left,left,left,left,left,left,left,left");       //设置列的左右对齐
        mygrid.setColTypes("ro,ro,ro,ro,ro,ro,ro,ro,ro,ro,ro,view");                //设置列的类型，一般ro 为只读类型，用的也最多
        mygrid.setColSorting("server,server,server,server,server,server,server,server,server,server,server,server");          //设置列的排序 int还是str
        mygrid.init();      //最后初始化列
        mygrid.attachEvent("onBeforeSorting", sortGridOnServer);
        mygrid.enablePaging(true, 30, null, "pagingArea", true, "recinfoArea");
        mygrid.setPagingSkin("bricks");
        gridQString = '/ZJCheck/Search?' + getQueryStr();

        myTabbar.tabs("gridboxOne").progressOn();
        mygrid.load(gridQString, doOnGridLoaded);

        var checkInstCombo = myForm.getCombo("CheckUnitName");
        checkInstCombo.enableFilteringMode('between');
        checkInstCombo.load("/ZJCheck/InstCombo");
        //setComboCustomFilter(checkInstCombo);


        var areaCombo = myForm.getCombo("Area")
        areaCombo.enableFilteringMode('between');
        areaCombo.load("/ZJCheck/AreaCombo")
        //setComboCustomFilter(areaCombo);
    }
  
    function getQueryStr() {
        var data = [];
        var formData = myForm.getFormData(true);
        for (var key in formData) {
            data.push(key + "=" + encodeURIComponent(formData[key]));
        }
        return data.join('&');
    }

    function getGirdSortStr(ind, direct) {
        var data = [];
        data.push("orderColInd" + "=" + encodeURIComponent(ind));
        data.push("direct" + "=" + encodeURIComponent(direct));
        return data.join('&');
    }


    function doOnGridLoaded() {
        myTabbar.tabs("gridboxOne").progressOff();
    }

    function excellView_click(obj) {
        var rowId = $(obj).attr('data-rowId');
        window.parent.Hui_admin_tab_raw("/ZJCheck/Details?id=" + rowId, "桩基方案查看");
    }

    function doOnUnload() {

    }

    function sortGridOnServer(ind, gridObj, direct) {
        //mygrid.clearAll();
        //mygrid.load(gridQString + (gridQString.indexOf("?") >= 0 ? "&amp;" : "?")
        // + "orderby=" + ind + "&amp;direct=" + direct);
        //mygrid.setSortImgState(true, ind, direct);
        return false;
    }


</script>