
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/Tab_Layout.cshtml";
}

 

<div class="container-fluid">
    <div class="row cl ml-5">
        <div id="form_container" style="width:auto;height:100%"></div>
    </div>
    <div class="mt-10">
        <div id="gridbox" style="position:fixed;width:100%; top:160px; left: 0; right: 0; bottom: 10px; background-color:white;overflow:hidden"></div>
    </div>
</div>

<script type="text/javascript">
    var mygrid, myForm, myTabbar, gridQString, ApplyWin, ApplyForm, dhxWins;

    function doOnLoad() {
        dhxWins = new dhtmlXWindows();
        var formStructure = [
           { type: "settings", position: "label-left", labelAlign: "right", inputWidth: 120, labelWidth: 100 },
          { type: "combo", label: "检测机构名称", name: "CustomId" },
           { type: "calendar", label: "报告开始日期", name: "ReportStartDate" },
          { type: "input", label: "高于设计强度值", name: "qiangduhigh" },
          { type: "combo", label: "养护条件", name: "yanghutiaojian" },
          { type: "newcolumn" },
          { type: "combo", label: "强度等级", name: "qiangdudengji" },
          { type: "calendar", label: "报告结束日期", name: "ReportEndDate" },
          { type: "input", label: "低于设计强度值", name: "qiangdulow" },
          { type: "newcolumn" },
          { type: "input", label: "工程名称", name: "projectName" },
          { type: "container", label: "地区选择", name: "Area" },
          { type: "checkbox", label: "无效值", name: "qiangduwuxiao" },
          { type: "button", name: 'Search', value: "查询", offsetLeft: 20, offsetTop: 0 }
        ];

        myForm = new dhtmlXForm("form_container", formStructure);

        areaCombo = new dhtmlXCombo(myForm.getContainer("Area"), null, null, "checkbox");
        areaCombo.load('/CheckStatis/AreaCombo');
        areaCombo.attachEvent("onClose", function () {
            areaCombo.setComboText(areaCombo.getChecked().join(','));
        });

        myForm.attachEvent("onButtonClick", function (name) {
            gridQString = '/CheckStatisSJKY/Search?' + getQueryStr();
            mygrid.clearAll();
            myTabbar.tabs("gridboxOne").progressOn();
            mygrid.load(gridQString, doOnGridLoaded);
        });


        var checkInstCombo = myForm.getCombo("CustomId");
        checkInstCombo.enableFilteringMode('between');;
        checkInstCombo.load("/CheckStatisSJKY/InstCombo");
        setComboCustomFilter(checkInstCombo);

        

        var yanghutiaojianCombo = myForm.getCombo("yanghutiaojian");
        yanghutiaojianCombo.enableFilteringMode('between');;
        yanghutiaojianCombo.load("/CheckStatisSJKY/YangHuTiaoJianCombo");
        setComboCustomFilter(yanghutiaojianCombo);

        var qiangdudengjiCombo = myForm.getCombo("qiangdudengji");
        qiangdudengjiCombo.enableFilteringMode('between');;
        qiangdudengjiCombo.load("/CheckStatisSJKY/QiangDuDengJiCombo");
        setComboCustomFilter(qiangdudengjiCombo);

        myTabbar = new dhtmlXTabBar({
            parent: "gridbox",
            tabs: [
                { id: "gridboxOne", text: "查询结果", active: true }
            ]
        });
        myTabbar.enableAutoReSize();
        mygrid = myTabbar.tabs("gridboxOne").attachGrid();
        myTabbar.tabs("gridboxOne").attachStatusBar({
            text: "<div id='recinfoArea'></div><div id='pagingArea'></div>",
            paging: true
        });
        gridQString = '/CheckStatisSJKY/Search?' + getQueryStr();

        // mygrid = new dhtmlXGridObject('gridbox');
        mygrid.setImagePath("../../Dhtmlx/codebase/imgs/");
        mygrid.setHeader("序号,工程名称,工程部位,机构名称,报告编号,设计强度等级,强度代表值（MPA）,达到设计强度的百分比");//the headers of columns
        mygrid.setInitWidths("40,*,150,*,150,150,150,150");          //the widths of columns
        mygrid.setColAlign("left,left,left,left,left,left,left,left");       //the alignment of columns
        mygrid.setColTypes("ro,ro,ro,ro,layuijslink,ro,ro,ro");                //the types of columns
        mygrid.setColSorting("server,server,server,server,server,server,server,server");          //the sorting types
        mygrid.init();      //finishes initialization and renders the grid on the page
        mygrid.enablePaging(true, 30, null, "pagingArea", true, "recinfoArea");
        mygrid.setPagingSkin("bricks");
        myTabbar.tabs("gridboxOne").progressOn();
        mygrid.load(gridQString, doOnGridLoaded);
    }
     
    function getQueryStr() {
        var data = [];
        var formData = myForm.getFormData(true);
        for (var key in formData) {
            data.push(key + "=" + encodeURIComponent(formData[key]));
        }
        data.push('Area' + '=' + encodeURIComponent(areaCombo.getComboText()));
        return data.join('&');
    }

    function excellView_click(obj) {
        var rowId = $(obj).attr('data-rowId');
        //window.parent.Hui_admin_tab_raw("/TBpProject/Details?id=" + rowId, "工程项目查看");
    }
     

    function doOnGridLoaded() {
        myTabbar.tabs("gridboxOne").progressOff();
    }

    function detailsReport(id) {
        window.parent.Hui_admin_tab_raw("/TotalSearch/Details?id=" + id, "检测报告查看");
    }

    function doOnUnload() {

    }
</script>
