
@{
    ViewBag.Title = "EditQualifyFive";
    Layout = "~/Views/Shared/Tab_Layout.cshtml";
}

<div class="container-fluid">    
    <div class="mt-5">
        <div id="gridbox" style="position:fixed;width:100%; height:800px; top:1px; left: 0; right: 0; bottom: 10px; background-color:white;overflow:hidden"></div>
    </div>
</div>
<script type="text/javascript">

    var myTabbar, mygrid, gridQString, myToolbar, myForm, exporter;

    function doOnLoad() {
        gridQString = '/NoDataUpload/GetReportNumberTotal';

        myTabbar = new dhtmlXTabBar({
            parent: "gridbox",
            tabs: [
                { id: "gridboxOne", text: "具备注册工程师资格人员情况", active: true }
            ]
        });

        myToolBar = myTabbar.tabs("gridboxOne").attachToolbar();
        myToolBar.setIconset("awesome");
        myToolBar.loadStruct("/ApplyQualify/FiveToolBar");

        myToolBar.attachEvent("onClick", function (id) {
            if (id = 'Create') {
                Create('@ViewBag.id');
            }
        });

        myTabbar.tabs("gridboxOne").attachStatusBar({
        text: "<div id='recinfoArea'></div><div id='pagingArea'></div>",
            paging: true
        });
        mygrid = myTabbar.tabs("gridboxOne").attachGrid();

        mygrid.setImagePath("../../Dhtmlx/codebase/imgs/");
        mygrid.setHeader("序号,检测类别,检测类容,姓名,注册资格证书号,上岗资格证书号,注册单位名称,职称,专业,学历,检测年限,注册证书有效期,备注,&nbsp,&nbsp,&nbsp");//the headers of columns
        mygrid.setInitWidths("40,*,160,160,160,160,160,160,100,100,100,100,160,50,50,50");          //the widths of columns
        mygrid.setColAlign("right,left,left,left,left,left,left,left,left,left,left,left,left,left,left,left");       //the alignment of columns
        mygrid.setColTypes("ro,ro,ro,ro,ro,ro,ro,ro,ro,ro,ro,ro,ro,view,edit,del");                //the types of columns
        mygrid.setColSorting("int,str,str,str,str,str,str,str,str,str,str,str,str,str,str,str");          //the sorting types
        mygrid.init();   //finishes initialization and renders the grid on the page
        mygrid.enablePaging(true, 30, null, "pagingArea", true, "recinfoArea");
        mygrid.setPagingSkin("bricks");
        myTabbar.tabs("gridboxOne").progressOn();
      
        mygrid.load('/ApplyQualify/EditQualifyFiveSearch?pid='+'@ViewBag.id', function () {
            myTabbar.tabs("gridboxOne").progressOff();
        });

    }

    function getQueryStr() {
        var data = [];
        var formData = myForm.getFormData(true);
        for (var key in formData) {
            data.push(key + "=" + encodeURIComponent(formData[key]));
        }
        return data.join('&');
    }

    function sortGridOnServer(ind, gridObj, direct) {

        return false;
    }

    function doOnUnload() {

    }
    function doOnGridLoaded() {
        myTabbar.tabs("gridboxOne").progressOff();
    }

    function Create(id) {
        layer.open({
            type: 2,
            area: ['700px', '450px'],
            fixed: false,
            maxmin: true,
            title: '导入具备注册工程师资格人员',
            content: '/ApplyQualify/CreateQualifyFive?id=' + id
        })
        mygrid.clearAll();
        mygrid.load('/ApplyQualify/EditQualifyFiveSearch?pid=' + '@ViewBag.id', function () {
            myTabbar.tabs("gridboxOne").progressOff();
        });
        //window.parent.Hui_admin_tab_raw("/ApplyQualify/CreateQualifyFive?id=" + id, "导入具备注册工程师资格人员");
    }


    function Img(url) {
        myCarousel = lookWin.attachCarousel();
        // var uploadedphoto = myForm.getItemValue(fileUrl);
        var photoarr = url.split('|');

        for (i = 0; i < photoarr.length; i++) {
            if (photoarr[i] && photoarr[i].length > 0) {
                myCarousel.addCell(photoarr[i]);

                myCarousel.cells(photoarr[i]).attachHTMLString("<div style='position: relative; left: 0px; top: 0px; overflow: auto; width: auto; height: 100%;'>" + "<img src='/ApplyQualify/Image?itemValue=" + encodeURIComponent(photoarr[i]) + "' border='0' style='width: 100%;'></div>");
            }
        }
    }

    function excellEdit_click(obj) {
        var rowId = $(obj).attr('data-rowId');
        window.parent.Hui_admin_tab_raw("/ApplyQualify/QualifyFivePeopleEdit?id=" + rowId, "编辑具备注册工程师资格人员");
    }


    function excellView_click(obj) {
        var rowId = $(obj).attr('data-rowId');
        window.parent.Hui_admin_tab_raw("/ApplyQualify/QualifyFivePeopleDetalify/" + rowId, "人员查看");
    }

    function excellDel_click(obj) {
        var rowId = $(obj).attr('data-rowId');
        dhtmlx.message({
            type: "confirm",
            text: "你确定要进行删除操作？",
            callback: function (u) {
                if (u) {
                    window.dhx.ajax.post("/ApplyQualify/DeteleFive", "id=" + rowId, function (response) {
                        var t = window.dhx.s2j(response.xmlDoc.responseText);
                        if (t != null && t.IsSucc) {
                            dhtmlx.message("删除成功！");
                            mygrid.clearAll();
                            mygrid.load('/ApplyQualify/EditQualifyFiveSearch?pid=' + '@ViewBag.id', function () {
                                myTabbar.tabs("gridboxOne").progressOff();
                            });

                        } else {
                            dhtmlx.alert(t.ErroMsg);
                        }

                    })
                }
            }

        })

    }

</script>


